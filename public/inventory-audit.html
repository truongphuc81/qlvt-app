<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Kho Th√¥ng Minh - QLVT</title>
    <link rel="icon" href="/logo.png" type="image/png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="audit-styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <script>
        // C·∫•u h√¨nh Firebase (Gi·ªØ nguy√™n nh∆∞ c≈©)
        const firebaseConfig = {
            apiKey: "AIzaSyAYiUIRQE1l-snjrZM7TJdp8YE7X8MMpEw",
            authDomain: "quan-ly-vat-tu-backend.firebaseapp.com",
            projectId: "quan-ly-vat-tu-backend",
            storageBucket: "quan-ly-vat-tu-backend.firebasestorage.app",
            messagingSenderId: "323292129107",
            appId: "1:323292129107:web:8e467d10c217197b9b63a6"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-boxes me-2"></i> KI·ªÇM KHO
            </a>
            <div class="d-flex text-white align-items-center">
                <span id="userEmailDisplay" class="me-3">ƒêang t·∫£i...</span>
                <button onclick="window.location.href='index.html'" class="btn btn-outline-light btn-sm">Tho√°t</button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm border-0 mb-3">
                    <div class="card-body">
                        <h5 class="card-title text-primary"><i class="fas fa-barcode"></i> Khu V·ª±c Qu√©t</h5>
                        
                        <div class="btn-group w-100 mb-3" role="group">
                            <input type="radio" class="btn-check" name="scanMode" id="modeQuick" autocomplete="off" checked onchange="toggleScanMode()">
                            <label class="btn btn-outline-primary" for="modeQuick">‚ö° Qu√©t Nhanh (+1)</label>
                          
                            <input type="radio" class="btn-check" name="scanMode" id="modeQty" autocomplete="off" onchange="toggleScanMode()">
                            <label class="btn btn-outline-primary" for="modeQty">üî¢ Qu√©t & Nh·∫≠p SL</label>
                        </div>

                        <div class="input-group input-group-lg mb-2">
                            <span class="input-group-text bg-white text-primary"><i class="fas fa-qrcode"></i></span>
                            <input type="text" id="scanInput" class="form-control fw-bold text-primary" placeholder="Qu√©t m√£ ho·∫∑c nh·∫≠p t√™n..." autocomplete="off" list="suggestions-list">
                            <datalist id="suggestions-list"></datalist>
                            <button class="btn btn-primary" onclick="processInputManual()">OK</button>
                        </div>
                        <small class="text-muted fst-italic">* M·∫πo: M√°y qu√©t m√£ v·∫°ch s·∫Ω t·ª± ƒë·ªông nh·∫•n Enter.</small>

                        <div id="cameraSection" class="mt-3" style="display:none;">
                            <div id="reader" style="width: 100%;"></div>
                        </div>
                        <button class="btn btn-outline-secondary w-100 mt-2" onclick="toggleCamera()">
                            <i class="fas fa-camera"></i> B·∫≠t/T·∫Øt Camera Laptop
                        </button>
                    </div>
                </div>

                <div class="card shadow-sm border-0 bg-white">
                    <div class="card-body">
                        <h5 class="card-title text-success">üìä Th·ªëng K√™ Phi√™n</h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                T·ªïng m√£ ƒë√£ qu√©t
                                <span class="badge bg-primary rounded-pill" id="statScannedCodes">0</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                T·ªïng s·ªë l∆∞·ª£ng th·ª±c t·∫ø
                                <span class="badge bg-success rounded-pill" id="statTotalQty">0</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                M√£ l·ªách kho
                                <span class="badge bg-danger rounded-pill" id="statDiffCodes">0</span>
                            </li>
                        </ul>
                        <div class="d-grid gap-2 mt-3">
                            <button class="btn btn-success" onclick="finishAudit()">‚úÖ Ho√†n T·∫•t & L∆∞u K·∫øt Qu·∫£</button>
                            <button class="btn btn-secondary" onclick="resetAudit()">üîÑ L√†m L·∫°i</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 text-primary fw-bold">üìã B·∫£ng ƒê·ªëi Chi·∫øu T·ªìn Kho</h5>
                        <div>
                            <input type="text" id="filterTable" class="form-control form-control-sm" placeholder="üîç L·ªçc trong b·∫£ng..." onkeyup="filterAuditTable()">
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive" style="height: 75vh;">
                            <table class="table table-hover table-striped align-middle mb-0" id="auditTable">
                                <thead class="table-light sticky-top">
                                    <tr>
                                        <th>M√£ H√†ng</th>
                                        <th>T√™n V·∫≠t T∆∞</th>
                                        <th class="text-center">T·ªìn M√°y</th>
                                        <th class="text-center">Th·ª±c T·∫ø</th>
                                        <th class="text-center">L·ªách</th>
                                        <th class="text-end">Gi√° Tr·ªã L·ªách</th>
                                        <th class="text-center">X√≥a</th>
                                    </tr>
                                </thead>
                                <tbody id="auditTableBody">
                                    <tr><td colspan="7" class="text-center py-5 text-muted">ƒêang t·∫£i d·ªØ li·ªáu kho...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script src="common.js"></script>
    <script src="inventory-audit.js"></script>
</body>
</html>